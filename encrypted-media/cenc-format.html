<!DOCTYPE html>
<html lang="en" dir="ltr" typeof="bibo:Document " about="" property="dcterms:language" content="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>ISO Common Encryption EME Stream Format and Initialization Data</title>
    
    
  <style>/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #ff4500;
}

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

@media print {
    .removeOnSave {
        display: none;
    }
}
</style><link href="https://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet"><!--[if lt IE 9]><script src='https://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--></head>
  <body class="h-entry" id="respecDocument" role="document"><div class="head" id="respecHeader" role="contentinfo">
  <p>
    
      <a href="http://www.w3.org/"><img width="72" height="48" alt="W3C" src="https://www.w3.org/Icons/w3c_home"></a>
    
  </p>
  <h1 class="title p-name" id="title" property="dcterms:title">ISO Common Encryption EME Stream Format and Initialization Data</h1>
  
  <h2 id="w3c-editor-s-draft-28-may-2014" property="dcterms:issued" content="2014-05-28T17:35:18.000Z" datatype="xsd:dateTime"><abbr title="World Wide Web Consortium">W3C</abbr> Editor's Draft <time class="dt-published" datetime="2014-05-28">28 May 2014</time></h2>
  <dl>
    
      <dt>This version:</dt>
      <dd><a class="u-url" href="http://dvcs.w3.org/hg/html-media/raw-file/default/encrypted-media/cenc-format.html">http://dvcs.w3.org/hg/html-media/raw-file/default/encrypted-media/cenc-format.html</a></dd>
      <dt>Latest published version:</dt>
      <dd><a href="http://www.w3.org/TR/cenc-format/">http://www.w3.org/TR/cenc-format/</a></dd>
    
    
      <dt>Latest editor's draft:</dt>
      <dd><a href="http://dvcs.w3.org/hg/html-media/raw-file/default/encrypted-media/cenc-format.html">http://dvcs.w3.org/hg/html-media/raw-file/default/encrypted-media/cenc-format.html</a></dd>
    
    
    
    
    
      
    
    
    
    <dt>Editors:</dt>
    <dd class="p-author h-card vcard" inlist="" rel="bibo:editor"><span typeof="foaf:Person"><span class="p-name fn" property="foaf:name">David Dorwin</span>, <a class="p-org org h-org h-card" href="http://www.google.com/" rel="foaf:workplaceHomepage">Google Inc.</a></span>
</dd>
<dd class="p-author h-card vcard" inlist="" rel="bibo:editor"><span typeof="foaf:Person"><span class="p-name fn" property="foaf:name">Adrian Bateman</span>, <a class="p-org org h-org h-card" href="http://www.microsoft.com/" rel="foaf:workplaceHomepage">Microsoft Corporation</a></span>
</dd>
<dd class="p-author h-card vcard" inlist="" rel="bibo:editor"><span typeof="foaf:Person"><span class="p-name fn" property="foaf:name">Mark Watson</span>, <a class="p-org org h-org h-card" href="http://www.netflix.com/" rel="foaf:workplaceHomepage">Netflix Inc.</a></span>
</dd>

    
    
  </dl>
  
  
  
  
    
      <p class="copyright">
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> ©
        2014
        
        <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
        (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
        <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), 
        
        All Rights Reserved.
        
        <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
        
          <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a>
        
        rules apply.
      </p>
    
  
  <hr>
</div>
    

    <p>This specification defines the stream format and initialization data for ISO Base media File Format (ISOBMFF) content using the ISO Common Encryption ('cenc') protection scheme.</p>

    <section id="stream-format" typeof="bibo:Chapter" rel="bibo:Chapter" resource="#stream-format">
      <!--OddPage--><h2 id="h2_stream-format" role="heading" aria-level="1"><span class="secno">1. </span>Stream Format</h2>
      <p>Under the 'cenc' protection scheme, ISOBMFF content is encrypted at the sample level with AES-128 CTR encryption, according to ISO/IEC 23001-7:2012, "Information technology - MPEG system technologies - Part 7: Common encryption in ISO base media file format files". This protection method enables multiple Key Systems to decrypt the same media content.</p>
      <p>Each key is identified by a Key ID and each encrypted sample is associated with the Key ID of the key needed to decrypt it. This association is signaled either through the specification of a default Key ID in the track encryption box ('tenc') or by assigning the sample to a Sample Group, the definition of which specifies a Key ID. Common encryption files may contain a mixture of encrypted and unencrypted samples.</p>
    </section>

    <section id="detect-encrypt" typeof="bibo:Chapter" rel="bibo:Chapter" resource="#detect-encrypt">
      <!--OddPage--><h2 id="h2_detect-encrypt" role="heading" aria-level="1"><span class="secno">2. </span>Detecting Encryption</h2>
      <p>Protection scheme signaling conforms with ISO/IEC 14496-12:2012. When protection has been applied, the stream type will be transformed to 'encv' for video or 'enca' for audio, with a Protection Scheme Information Box ('sinf') added to the sample entry in the Sample Description Box ('stsd'). The Protection Scheme Information Box ('sinf') will contain a Scheme Type Box ('schm') with a scheme_type field set to a value of 'cenc' (Common Encryption).</p>
      <p>The "encrypted block" is a sample. Determining whether a sample is encrypted depends on the corresponding Track Encryption Box ('tenc') and the sample group with grouping type 'seig' (CencSampleEncryption group), if any, associated with the sample.
      The default encryption state of a sample is defined by the IsEncrypted flag in the associated track encryption box ('tenc'). This default state may be modified by the IsEncrypted flag in the SampleGroupDescriptionBox ('sgpd'), pointed to by an index in the SampleToGroupBox ('sbgp').</p>
      <p>Samples can be partially encrypted, specified by subsample information referenced by SampleAuxiliaryInformationSizesBox (‘saiz’) and SampleAuxiliaryInformationOffsetsBox ('saio') boxes.</p>
      <p>For complete information, see ISO/IEC 23001-7:2012.</p>
    </section>

    <section id="init-data" typeof="bibo:Chapter" rel="bibo:Chapter" resource="#init-data">
      <!--OddPage--><h2 id="h2_init-data" role="heading" aria-level="1"><span class="secno">3. </span>Initialization Data and Events</h2>
      <p>Common Encryption files may contain one or more protection system specific header ('pssh') boxes, each for a different SystemID.</p>
      <p>‘pssh’ boxes stored in movie fragment boxes are intended to store keys referenced by KID in a sample group description contained in that movie fragment, where the KID in the sample group description overrides the default_KID specified for the track in the track encryption box (‘tenc’).  Each ‘moof’/’pssh’ must protect the contained keys with a SystemID specific method.  Sample groups and ‘pssh’ key storage in movie fragments enable keys to be changed and accessed without interruption during playback of a track.</p>
	  <p>ISO Common Encryption 2nd Edition also specifies storage of a ‘pssh’ box base64 encoded in an XML element of the form &lt;cenc:pssh (base64 ‘pssh’)&gt;.  For instance, DASH manifests may provide ‘pssh’ boxes in this format, each contained in a ContentProtection Descriptor element identified by a SystemID.  These ‘pssh’ boxes may be decoded and concatenated by an application to provide equivalent Initialization Data to that stored in movie or movie fragment boxes.</p>

      <p><a href="encrypted-media.html#initialization-data">Initialization Data</a> is always one or more concatenated 'pssh' boxes.  The application may parse out 'pssh' boxes which do not correspond to the selected key system, and may not use the InitData from the file at all and instead use initData from another source (e.g. the XML element described above). The CDM must be able to filter multiple 'pssh' in the initData to find the 'pssh' box which is Key System appropriate.</p>
      <p>Each time one or more 'pssh' boxes are encountered, the <a href="encrypted-media.html#algorithms-initdata-encountered">Initialization Data Encountered</a> algorithm shall be invoked with <var title="">initDataType</var> = "cenc" and <var title="">initData</var> = the 'pssh' boxes(s).  Multiple 'pssh' boxes must be provided together if and only if they appear directly next to each other in the file.</p>

      <p>If a supported 'pssh' box (based on SystemID) is not found while processing the <var>initData</var> in the <code><a href="encrypted-media.html#dom-createsession">createSession()</a></code> algorithm, follow the algorithm step for "<var>init data</var> is not supported by the <var>cdm</var>."</p>
    </section>
    
    <section id="common-system" typeof="bibo:Chapter" rel="bibo:Chapter" resource="#common-system">
      <!--OddPage--><h2 id="h2_common-system" role="heading" aria-level="1"><span class="secno">4. </span>Common SystemID and PSSH Box Format</h2>
      <p>This section defines a common open SystemID and PSSH box format for use with EME.
        Key System implementations supporting ISO Common Encryption should support this SystemID and format, though they may prefer another SystemID when present in the Initialization Data.
        It is also recommended that media resources contain appropriate PSSH box(s) for this SystemID so that they may be used by any Key System implementation that supports it.</p>
      <p><a href="encrypted-media.html#clear-key">Clear Key</a> uses this SystemID for ISO Common Encryption content.
        When <code><a href="encrypted-media.html#dom-createsession">createSession()</a></code> is called with <var>initDataType</var> "cenc", the Clear Key CDM will use the PSSH box with this SystemID to generate a license request.
      </p>
      <section id="common-system-definition" typeof="bibo:Chapter" rel="bibo:Chapter" resource="#common-system-definition">
        <h3 id="h3_common-system-definition" role="heading" aria-level="2"><span class="secno">4.1 </span>Definition</h3>
        <p>The SystemID is 1077efec-c0b2-4d02-ace3-3c1e52e2fb4b.</p>
        <p> The PSSH box format is as follows:</p>
        <dl>
          <dt>version</dt>
          <dd>1</dd>
          <dt>KID and KID_count</dt>
          <dd>The key ID(s) represented by the PSSH box. For example, those key ID(s) used by the Movie ('moov') or Movie Fragment ('moof').</dd>
          <dt>Data and DataSize</dt>
          <dd>Reserved for future use. DataSize must be 0.</dd>
        </dl>
      </section>
    </section>
    
  

</body></html>
